<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
	PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="prod">
	
	<!-- 
	<i	nsert id="insertProd" parameterType="prodVo">
		insert into prod (prod_id, prod_date, prod_name, prod_content, prod_price,
    					  prod_image, prod_yn, prod_sale, dcate_id) 
    	values('P' || TO_CHAR(prod_seq.NEXTVAL, 'FM000000'), sysdate, #{prod_name}, #{prod_content}, #{prod_price},
    	#{prod_image}, #{prod_yn}, #{prod_sale},#{dcate_id})
	</insert>
	 -->
	
	
	
	<insert id="insertProd" parameterType="prodVo">
	
	
	 <selectKey keyProperty="prod_id"  order="BEFORE" resultType="string">
	      select 'P' || TO_CHAR(prod_seq.NEXTVAL, 'FM000000')  from dual
	   </selectKey>
	   
	   
    	insert into prod (prod_id, prod_date, prod_name, prod_content, prod_price,
                      	  prod_yn, prod_sale, dcate_id) 
    	values(#{prod_id}, sysdate, #{prod_name}, #{prod_content}, #{prod_price},
        #{prod_yn}, #{prod_sale}, #{dcate_id})
        
        
       
	</insert>
	

	 
	<delete id="deleteProd" parameterType="String">
		delete from prod where prod_id = #{prod_id}
	</delete>
	
	<update id="updateProd" parameterType="prodVo">
		update prod set 
		prod_date = sysdate, prod_name = #{prod_name}, prod_content = #{prod_content}, prod_price = #{prod_price},
		prod_yn = #{prod_yn}, prod_sale = #{prod_sale},
		dcate_id = (select dcate_id from detail_category where dcate_id = #{dcate_id})
		where prod_id = #{prod_id}
	</update>
	
	<select id="getAllProd" resultType="prodVo">
		select * from prod order by prod_id desc
	</select>
	
	<select id="getOneProd" parameterType="String" resultType="prodVo">
		select * from prod where prod_id = #{prod_id}
	</select>
		
	<select id="getWishListByMemberId" parameterType="string" resultType="prodVo">
		SELECT *
		FROM WISHLIST w
				 JOIN PROD p ON w.PROD_ID = p.PROD_ID
		WHERE w.MEM_ID = #{mem_id}
	</select>
	
	<!-- (이번달 기준) 신상품 조회 -->
	<select id="selectForNewArr" resultType="prodVo">
		select * from prod
		where extract(month from prod_date) = extract(month from sysdate)
  			  and extract(year from prod_date) = extract(year from sysdate)
  		order by prod_date desc
	</select>
	
	<!-- (좋아요 기준) 베스트 조회 -->
	<select id="selectForBest" resultType="prodVo">
		select p.*, l.like_count from prod p
		join (select prod_id, count(*) as like_count
    		  from likes
    		  group by prod_id) 
    	l on p.prod_id = l.prod_id
		order by l.like_count desc
	</select>
	
	<!-- (카테고리 기준) 겉옷 종류 조회-->
	<select id="selectForOuter" resultType="prodVo">
		select p.* from prod p
		join detail_category dc on p.dcate_id = dc.dcate_id
		where dc.cate_id = 'c000001'
	</select>
	
	<!-- (카테고리 기준) 상의 종류 조회 -->
	<select id="selectForTop" resultType="prodVo">
		select p.* from prod p
		join detail_category dc on p.dcate_id = dc.dcate_id
		where dc.cate_id = 'c000002'
	</select>
	
	<!-- (카테고리 기준) 하의 종류 조회 -->
	<select id="selectForBottom" resultType="prodVo">
		select p.* from prod p
		join detail_category dc on p.dcate_id = dc.dcate_id
		where dc.cate_id = 'c000003'
	</select>
	
	<!-- (카테고리 기준) 악세서리 종류 조회 -->
	<select id="selectForAcc" resultType="prodVo">
		select p.* from prod p
		join detail_category dc on p.dcate_id = dc.dcate_id
		where dc.cate_id = 'c000004'
	</select>


</mapper>












